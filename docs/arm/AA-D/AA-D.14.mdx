---
sidebar_position:  168
---

# D.14. Execution Time

:::danger
This Reference Manual output has not been verified,
and may contain omissions or errors.
Report any problems on the [tracking issue](https://github.com/ada-lang-io/ada-lang-io/issues/20)
:::

import Admonition from "@theme/Admonition";
import AnnotatedOnly from "@site/src/components/AnnotatedOnly";
import CodeBlock from "@theme/CodeBlock";
import MarginText from "@site/src/components/MarginText";
import MarginInfo from "@site/src/components/MarginInfo";

<MarginText>1/3</MarginText>
<MarginInfo items={["AI95-00307-01", "AI05-0299-1"]} />
<p>This subclause describes a language-defined package to measure execution time. <br /></p>


#### Static Semantics

<MarginText>2/2</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>The following language-defined library package exists: <br /></p>

<MarginText>3/5</MarginText>
<MarginInfo items={["AI12-0241-1", "AI12-0302-1"]} />
<CodeBlock language="ada">
with Ada.Task{"_"}Identification;{"\n"}with Ada.Real{"_"}Time; use Ada.Real{"_"}Time;{"\n"}package Ada.Execution{"_"}Time{"\n"}   with Nonblocking, Global ={">"} in out synchronized is{"\n"}
<MarginText>4/2</MarginText>
   type CPU{"_"}Time is private;{"\n"}   CPU{"_"}Time{"_"}First : constant CPU{"_"}Time;{"\n"}   CPU{"_"}Time{"_"}Last  : constant CPU{"_"}Time;{"\n"}   CPU{"_"}Time{"_"}Unit  : constant := implementation-defined-real-number;{"\n"}   CPU{"_"}Tick : constant Time{"_"}Span;{"\n"}
<MarginText>5/2</MarginText>
   function Clock{"\n"}     (T : Ada.Task{"_"}Identification.Task{"_"}Id{"\n"}          := Ada.Task{"_"}Identification.Current{"_"}Task){"\n"}     return CPU{"_"}Time;{"\n"}
<MarginText>6/2</MarginText>
   function "+"  (Left : CPU{"_"}Time; Right : Time{"_"}Span) return CPU{"_"}Time;{"\n"}   function "+"  (Left : Time{"_"}Span; Right : CPU{"_"}Time) return CPU{"_"}Time;{"\n"}   function "-"  (Left : CPU{"_"}Time; Right : Time{"_"}Span) return CPU{"_"}Time;{"\n"}   function "-"  (Left : CPU{"_"}Time; Right : CPU{"_"}Time)  return Time{"_"}Span;{"\n"}
<MarginText>7/2</MarginText>
   function "{"<"}"  (Left, Right : CPU{"_"}Time) return Boolean;{"\n"}   function "{"<"}=" (Left, Right : CPU{"_"}Time) return Boolean;{"\n"}   function "{">"}"  (Left, Right : CPU{"_"}Time) return Boolean;{"\n"}   function "{">"}=" (Left, Right : CPU{"_"}Time) return Boolean;{"\n"}
<MarginText>8/2</MarginText>
   procedure Split{"\n"}     (T : in CPU{"_"}Time; SC : out Seconds{"_"}Count; TS : out Time{"_"}Span);{"\n"}
<MarginText>9/2</MarginText>
   function Time{"_"}Of (SC : Seconds{"_"}Count;{"\n"}                     TS : Time{"_"}Span := Time{"_"}Span{"_"}Zero) return CPU{"_"}Time;{"\n"}
<MarginText>9.1/3</MarginText>
<MarginInfo items={["AI05-0170-1"]} />
   Interrupt{"_"}Clocks{"_"}Supported : constant Boolean := implementation-defined;{"\n"}
<MarginText>9.2/3</MarginText>
<MarginInfo items={["AI05-0170-1"]} />
   Separate{"_"}Interrupt{"_"}Clocks{"_"}Supported : constant Boolean :={"\n"}     implementation-defined;{"\n"}
<MarginText>9.3/3</MarginText>
<MarginInfo items={["AI05-0170-1"]} />
   function Clock{"_"}For{"_"}Interrupts return CPU{"_"}Time;{"\n"}
<MarginText>10/2</MarginText>
private{"\n"}   ... -- not specified by the language{"\n"}end Ada.Execution{"_"}Time;{"\n"}

</CodeBlock>
<MarginText>11/3</MarginText>
<MarginInfo items={["AI95-00307-01", "AI05-0170-1", "AI05-0269-1"]} />
<p>The <i>execution time</i> or CPU time of a given task is defined as the time spent by the system executing that task, including the time spent executing run-time or system services on its behalf. The mechanism used to measure execution time is implementation defined. The Boolean constant Interrupt{"_"}Clocks{"_"}Supported is set to True if the implementation separately accounts for the execution time of interrupt handlers. If it is set to False it is implementation defined which task, if any, is charged the execution time that is consumed by interrupt handlers. The Boolean constant Separate{"_"}Interrupt{"_"}Clocks{"_"}Supported is set to True if the implementation separately accounts for the execution time of individual interrupt handlers (see <a href="/docs/arm/AA-D/AA-D.14#Subclause_D.14.3">D.14.3</a>). <br /></p>

<AnnotatedOnly>
<MarginText>11.a/2</MarginText>
<Admonition type="aarm" aarm="discussion">
<b></b>The implementation-defined properties above and of the values declared in the package are repeated in Documentation Requirements, so we don't mark them as implementation-defined. <br />
</Admonition>
</AnnotatedOnly>

<MarginText>12/2</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>The type CPU{"_"}Time represents the execution time of a task. The set of values of this type corresponds one-to-one with an implementation-defined range of mathematical integers.<br /></p>

<MarginText>13/2</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>The CPU{"_"}Time value I represents the half-open execution-time interval that starts with I{"*"}CPU{"_"}Time{"_"}Unit and is limited by (I+1){"*"}CPU{"_"}Time{"_"}Unit, where CPU{"_"}Time{"_"}Unit is an implementation-defined real number. For each task, the execution time value is set to zero at the creation of the task.<br /></p>

<AnnotatedOnly>
<MarginText>13.a/2</MarginText>
<Admonition type="aarm" aarm="ramification">
<b></b>Since it is implementation-defined which task is charged execution time for system services, the execution time value may become nonzero even before the start of the activation of the task. <br />
</Admonition>
</AnnotatedOnly>

<MarginText>14/2</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>CPU{"_"}Time{"_"}First and CPU{"_"}Time{"_"}Last are the smallest and largest values of the CPU{"_"}Time type, respectively. <br /></p>

<MarginText>14.1/3</MarginText>
<MarginInfo items={["AI05-0170-1"]} />
<p>The execution time value for the function Clock{"_"}For{"_"}Interrupts is initialized to zero.<br /></p>


#### Dynamic Semantics

<MarginText>15/2</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>CPU{"_"}Time{"_"}Unit is the smallest amount of execution time representable by the CPU{"_"}Time type; it is expressed in seconds. A <i>CPU clock tick</i> is an execution time interval during which the clock value (as observed by calling the Clock function) remains constant. CPU{"_"}Tick is the average length of such intervals.<br /></p>

<MarginText>16/2</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>The effects of the operators on CPU{"_"}Time and Time{"_"}Span are as for the operators defined for integer types.<br /></p>

<MarginText>17/2</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>The function Clock returns the current execution time of the task identified by T; Tasking{"_"}Error is raised if that task has terminated; Program{"_"}Error is raised if the value of T is Task{"_"}Identification.Null{"_"}Task{"_"}Id.<br /></p>

<MarginText>18/2</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>The effects of the Split and Time{"_"}Of operations are defined as follows, treating values of type CPU{"_"}Time, Time{"_"}Span, and Seconds{"_"}Count as mathematical integers. The effect of Split (T, SC, TS) is to set SC and TS to values such that T{"*"}CPU{"_"}Time{"_"}Unit = SC{"*"}1.0 + TS{"*"}CPU{"_"}Time{"_"}Unit, and 0.0 {"<"}= TS{"*"}CPU{"_"}Time{"_"}Unit {"<"} 1.0. The value returned by Time{"_"}Of(SC,TS) is the execution-time value T such that T{"*"}CPU{"_"}Time{"_"}Unit=SC{"*"}1.0 + TS{"*"}CPU{"_"}Time{"_"}Unit.<br /></p>

<MarginText>18.1/3</MarginText>
<MarginInfo items={["AI05-0170-1"]} />
<p>The function Clock{"_"}For{"_"}Interrupts returns the total cumulative time spent executing within all interrupt handlers. This time is not allocated to any task execution time clock. If Interrupt{"_"}Clocks{"_"}Supported is set to False the function raises Program{"_"}Error.<br /></p>


#### Erroneous Execution

<MarginText>19/2</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>For a call of Clock, if the task identified by T no longer exists, the execution of the program is erroneous. <br /></p>


#### Implementation Requirements

<MarginText>20/2</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>The range of CPU{"_"}Time values shall be sufficient to uniquely represent the range of execution times from the task start-up to 50 years of execution time later. CPU{"_"}Tick shall be no greater than 1 millisecond. <br /></p>


#### Documentation Requirements

<MarginText>21/2</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>The implementation shall document the values of CPU{"_"}Time{"_"}First, CPU{"_"}Time{"_"}Last, CPU{"_"}Time{"_"}Unit, and CPU{"_"}Tick. <br /></p>

<AnnotatedOnly>
<MarginText>21.a/2</MarginText>
<Admonition type="aarm" aarm="note">
<b>Documentation Requirement: </b>The values of CPU{"_"}Time{"_"}First, CPU{"_"}Time{"_"}Last, CPU{"_"}Time{"_"}Unit, and CPU{"_"}Tick of package Execution{"_"}Time.<br />
</Admonition>
</AnnotatedOnly>

<MarginText>22/2</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>The implementation shall document the properties of the underlying mechanism used to measure execution times, such as the range of values supported and any relevant aspects of the underlying hardware or operating system facilities used. <br /></p>

<AnnotatedOnly>
<MarginText>22.a/3</MarginText>
<Admonition type="aarm" aarm="note">
<b>Documentation Requirement: </b>The properties of the mechanism used to implement package Execution{"_"}Time, including the values of the constants defined in the package.<br />
</Admonition>
</AnnotatedOnly>


#### Metrics

<MarginText>23/2</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>The implementation shall document the following metrics:<br /></p>

<MarginText>24/2</MarginText>
<ul>
<li>An upper bound on the execution-time duration of a clock tick. This is a value D such that if t1 and t2 are any execution times of a given task such that t1 {"<"} t2 and Clockt1 = Clockt2 then t2 &ndash; t1 {"<"}= D.<br /></li>
<MarginText>25/2</MarginText>
<li>An upper bound on the size of a clock jump. A clock jump is the difference between two successive distinct values of an execution-time clock (as observed by calling the Clock function with the same Task{"_"}Id).<br /></li>
<MarginText>26/2</MarginText>
<li>An upper bound on the execution time of a call to the Clock function, in processor clock cycles.<br /></li>
<MarginText>27/2</MarginText>
<li>Upper bounds on the execution times of the operators of the type CPU{"_"}Time, in processor clock cycles. <br /></li>
</ul>
<AnnotatedOnly>
<MarginText>27.a/2</MarginText>
<Admonition type="aarm" aarm="note">
<b>Documentation Requirement: </b>The metrics for execution time.<br />
</Admonition>
</AnnotatedOnly>


#### Implementation Permissions

<MarginText>28/5</MarginText>
<MarginInfo items={["AI95-00307-01", "AI12-0444-1"]} />
<p>Implementations targeted to machines with word size smaller than 32 bits may omit support for the full range and granularity of the CPU{"_"}Time type.<br /></p>


#### Implementation Advice

<MarginText>29/2</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>When appropriate, implementations should provide configuration mechanisms to change the value of CPU{"_"}Tick. <br /></p>

<AnnotatedOnly>
<MarginText>29.a/2</MarginText>
<Admonition type="aarm" aarm="implementation-advice">
<b></b>When appropriate, implementations should provide configuration mechanisms to change the value of Execution{"_"}Time.CPU{"_"}Tick.<br />
</Admonition>
</AnnotatedOnly>

<AnnotatedOnly>

#### Extensions to Ada 95

</AnnotatedOnly>
<AnnotatedOnly>
<MarginText>29.b/2</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<Admonition type="aarm" aarm="note">
The package Execution{"_"}Time is new. <br />
</Admonition>
</AnnotatedOnly>

<AnnotatedOnly>

#### Incompatibilities With Ada 2005

</AnnotatedOnly>
<AnnotatedOnly>
<MarginText>29.c/3</MarginText>
<MarginInfo items={["AI05-0170-1"]} />
<Admonition type="aarm" aarm="note">
Function Clock{"_"}For{"_"}Interrupts, and constants Interrupt{"_"}Clocks{"_"}Supported and Separate{"_"}Interrupt{"_"}Clocks{"_"}Supported are added to Execution{"_"}Time. If Execution{"_"}Time is referenced in a <code><a href="/docs/arm/AA-8/AA-8.4#S0235">use_clause</a></code>, and an entity <i>E</i> with a <code><a href="/docs/arm/AA-3/AA-3.1#S0022">defining_identifier</a></code> of one of the added entities is defined in a package that is also referenced in a <code><a href="/docs/arm/AA-8/AA-8.4#S0235">use_clause</a></code>, the entity <i>E</i> may no longer be use-visible, resulting in errors. This should be rare and is easily fixed if it does occur. <br />
</Admonition>
</AnnotatedOnly>

<AnnotatedOnly>

#### Wording Changes from Ada 2005

</AnnotatedOnly>
<AnnotatedOnly>
<MarginText>29.d/3</MarginText>
<MarginInfo items={["AI05-0170-1"]} />
<Admonition type="aarm" aarm="note">
If Interrupt{"_"}Clocks{"_"}Supported is True, it is now possible to determine the execution time of interrupt handlers. This is not an inconsistency, as not charging any task for such time was a legitimate implementation for Ada 2005. <br />
</Admonition>
</AnnotatedOnly>

<a id="Subclause_D.14.1"></a>

## D.14.1  Execution Time Timers

<MarginText>1/3_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01", "AI05-0299-1"]} />
<p>This subclause describes a language-defined package that provides a facility for calling a handler when a task has used a defined amount of CPU time. <br /></p>


#### Static Semantics

<MarginText>2/2_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>The following language-defined library package exists: <br /></p>

<MarginText>3/5_D.14.1</MarginText>
<MarginInfo items={["AI12-0241-1", "AI12-0302-1"]} />
<CodeBlock language="ada">
with System;{"\n"}package Ada.Execution{"_"}Time.Timers{"\n"}   with Nonblocking, Global ={">"} in out synchronized is{"\n"}
<MarginText>4/2_D.14.1</MarginText>
   type Timer (T : not null access constant{"\n"}                       Ada.Task{"_"}Identification.Task{"_"}Id) is{"\n"}      tagged limited private;{"\n"}
<MarginText>5/5_D.14.1</MarginText>
<MarginInfo items={["AI12-0241-1"]} />
   type Timer{"_"}Handler is{"\n"}      access protected procedure (TM : in out Timer){"\n"}      with Nonblocking ={">"} False;{"\n"}
<MarginText>6/2_D.14.1</MarginText>
   Min{"_"}Handler{"_"}Ceiling : constant System.Any{"_"}Priority :={"\n"}   implementation-defined;{"\n"}
<MarginText>7/2_D.14.1</MarginText>
   procedure Set{"_"}Handler (TM      : in out Timer;{"\n"}                          In{"_"}Time : in Time{"_"}Span;{"\n"}                          Handler : in Timer{"_"}Handler);{"\n"}   procedure Set{"_"}Handler (TM      : in out Timer;{"\n"}                          At{"_"}Time : in CPU{"_"}Time;{"\n"}                          Handler : in Timer{"_"}Handler);{"\n"}   function Current{"_"}Handler (TM : Timer) return Timer{"_"}Handler;{"\n"}   procedure Cancel{"_"}Handler (TM        : in out Timer;{"\n"}                             Cancelled :    out Boolean);{"\n"}
<MarginText>8/2_D.14.1</MarginText>
   function Time{"_"}Remaining (TM : Timer) return Time{"_"}Span;{"\n"}
<MarginText>9/2_D.14.1</MarginText>
   Timer{"_"}Resource{"_"}Error : exception;{"\n"}
<MarginText>10/2_D.14.1</MarginText>
private{"\n"}   ... -- not specified by the language{"\n"}end Ada.Execution{"_"}Time.Timers;{"\n"}

</CodeBlock>
<MarginText>11/2_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>The type Timer represents an execution-time event for a single task and is capable of detecting execution-time overruns. The access discriminant T identifies the task concerned. The type Timer needs finalization (see <a href="/docs/arm/AA-7/AA-7.6">7.6</a>).<br /></p>

<MarginText>12/2_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>An object of type Timer is said to be <i>set</i> if it is associated with a nonnull value of type Timer{"_"}Handler and <i>cleared</i> otherwise. All Timer objects are initially cleared. <br /></p>

<MarginText>13/2_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>The type Timer{"_"}Handler identifies a protected procedure to be executed by the implementation when the timer expires. Such a protected procedure is called a <i>handler</i>. <br /></p>

<AnnotatedOnly>
<MarginText>13.a/2_D.14.1</MarginText>
<Admonition type="aarm" aarm="discussion">
<b></b>Type Timer is tagged. This makes it possible to share a handler between several events. In simple cases, 'Access can be used to compare the parameter with a specific timer object (this works because a tagged type is a by-reference type). In more complex cases, a type extension of type Timer can be declared; a double type conversion can be used to access the extension data. An example of how this can be done can be found for the similar type Timing{"_"}Event, see <a href="/docs/arm/AA-D/AA-D.15">D.15</a>. <br />
</Admonition>
</AnnotatedOnly>


#### Dynamic Semantics

<MarginText>14/2_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>When a Timer object is created, or upon the first call of a Set{"_"}Handler procedure with the timer as parameter, the resources required to operate an execution-time timer based on the associated execution-time clock are allocated and initialized. If this operation would exceed the available resources, Timer{"_"}Resource{"_"}Error is raised.<br /></p>

<MarginText>15/3_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01", "AI05-0264-1"]} />
<p>The procedures Set{"_"}Handler associate the handler Handler with the timer TM: if Handler is <b>null</b>, the timer is cleared; otherwise, it is set. The first procedure Set{"_"}Handler loads the timer TM with an interval specified by the Time{"_"}Span parameter. In this mode, the timer TM <i>expires</i> when the execution time of the task identified by TM.T.<b>all</b> has increased by In{"_"}Time; if In{"_"}Time is less than or equal to zero, the timer expires immediately. The second procedure Set{"_"}Handler loads the timer TM with the absolute value specified by At{"_"}Time. In this mode, the timer TM expires when the execution time of the task identified by TM.T.<b>all</b> reaches At{"_"}Time; if the value of At{"_"}Time has already been reached when Set{"_"}Handler is called, the timer expires immediately.<br /></p>

<AnnotatedOnly>
<MarginText>15.a/2_D.14.1</MarginText>
<Admonition type="aarm" aarm="implementation-note">
<b></b>Since an access-to-constant can designate a variable, the Task{"_"}Id value designated by the discriminant of a Timer object can be changed after the object is created. Thus, an implementation cannot use the value of the Task{"_"}Id other than where this Reference Manual specifies. For instance, the Task{"_"}Id should be read when the timer is set, but it should not be used when the timer expires (as it may designate a different task at that point). <br />
</Admonition>
</AnnotatedOnly>

<MarginText>16/2_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>A call of a procedure Set{"_"}Handler for a timer that is already set replaces the handler and the (absolute or relative) execution time; if Handler is not <b>null</b>, the timer remains set.<br /></p>

<MarginText>17/2_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>When a timer expires, the associated handler is executed, passing the timer as parameter. The initial action of the execution of the handler is to clear the event.<br /></p>

<MarginText>18/3_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01", "AI05-0264-1"]} />
<p>The function Current{"_"}Handler returns the handler associated with the timer TM if that timer is set; otherwise, it returns <b>null</b>.<br /></p>

<MarginText>19/3_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01", "AI05-0264-1"]} />
<p>The procedure Cancel{"_"}Handler clears the timer if it is set. Cancelled is assigned True if the timer was set prior to it being cleared; otherwise, it is assigned False.<br /></p>

<MarginText>20/3_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01", "AI05-0264-1"]} />
<p>The function Time{"_"}Remaining returns the execution time interval that remains until the timer TM would expire, if that timer is set; otherwise, it returns Time{"_"}Span{"_"}Zero.<br /></p>

<MarginText>21/2_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>The constant Min{"_"}Handler{"_"}Ceiling is the minimum ceiling priority required for a protected object with a handler to ensure that no ceiling violation will occur when that handler is invoked.<br /></p>

<MarginText>22/2_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>As part of the finalization of an object of type Timer, the timer is cleared.<br /></p>

<MarginText>23/2_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>For all the subprograms defined in this package, Tasking{"_"}Error is raised if the task identified by TM.T.<b>all</b> has terminated, and Program{"_"}Error is raised if the value of TM.T.<b>all</b> is Task{"_"}Identification.Null{"_"}Task{"_"}Id.<br /></p>

<MarginText>24/2_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>An exception propagated from a handler invoked as part of the expiration of a timer has no effect.<br /></p>


#### Erroneous Execution

<MarginText>25/2_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>For a call of any of the subprograms defined in this package, if the task identified by TM.T.<b>all</b> no longer exists, the execution of the program is erroneous.<br /></p>


#### Implementation Requirements

<MarginText>26/2_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>For a given Timer object, the implementation shall perform the operations declared in this package atomically with respect to any of these operations on the same Timer object. The replacement of a handler by a call of Set{"_"}Handler shall be performed atomically with respect to the execution of the handler.<br /></p>

<AnnotatedOnly>
<MarginText>26.a/2_D.14.1</MarginText>
<Admonition type="aarm" aarm="reason">
<b></b>This prevents various race conditions. In particular it ensures that if an event occurs when Set{"_"}Handler is changing the handler then either the new or old handler is executed in response to the appropriate event. It is never possible for a new handler to be executed in response to an old event <br />
</Admonition>
</AnnotatedOnly>

<MarginText>27/2_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<p>When an object of type Timer is finalized, the system resources used by the timer shall be deallocated.<br /></p>


#### Implementation Permissions

<MarginText>28/3_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01", "AI05-0264-1"]} />
<p>Implementations may limit the number of timers that can be defined for each task. If this limit is exceeded, then Timer{"_"}Resource{"_"}Error is raised.<br /></p>

<AnnotatedOnly>
<MarginText>29/2_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<Admonition type="aarm" aarm="note">
NOTE   A Timer{"_"}Handler can be associated with several Timer objects.<br />
</Admonition>
</AnnotatedOnly>

<AnnotatedOnly>

#### Extensions to Ada 95

</AnnotatedOnly>
<AnnotatedOnly>
<MarginText>29.a/2_D.14.1</MarginText>
<MarginInfo items={["AI95-00307-01"]} />
<Admonition type="aarm" aarm="note">
The package Execution{"_"}Time.Timers is new. <br />
</Admonition>
</AnnotatedOnly>

<a id="Subclause_D.14.2"></a>

## D.14.2  Group Execution Time Budgets

<MarginText>1/3_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01", "AI05-0299-1"]} />
<p>This subclause describes a language-defined package to assign execution time budgets to groups of tasks. <br /></p>


#### Static Semantics

<MarginText>2/2_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01"]} />
<p>The following language-defined library package exists: <br /></p>

<MarginText>3/5_D.14.2</MarginText>
<MarginInfo items={["AI05-0169-1", "AI12-0241-1", "AI12-0302-1"]} />
<CodeBlock language="ada">
with System;{"\n"}with System.Multiprocessors;{"\n"}package Ada.Execution{"_"}Time.Group{"_"}Budgets{"\n"}  with Nonblocking, Global ={">"} in out synchronized is{"\n"}
<MarginText>4/3_D.14.2</MarginText>
<MarginInfo items={["AI05-0092-1", "AI05-0169-1"]} />
  type Group{"_"}Budget(CPU : System.Multiprocessors.CPU :={"\n"}                             System.Multiprocessors.CPU'First){"\n"}    is tagged limited private;{"\n"}
<MarginText>5/5_D.14.2</MarginText>
<MarginInfo items={["AI12-0241-1"]} />
  type Group{"_"}Budget{"_"}Handler is access{"\n"}       protected procedure (GB : in out Group{"_"}Budget){"\n"}       with Nonblocking ={">"} False;{"\n"}
<MarginText>6/2_D.14.2</MarginText>
  type Task{"_"}Array is array (Positive range {"<"}{">"}) of{"\n"}                                  Ada.Task{"_"}Identification.Task{"_"}Id;{"\n"}
<MarginText>7/2_D.14.2</MarginText>
  Min{"_"}Handler{"_"}Ceiling : constant System.Any{"_"}Priority :={"\n"}    implementation-defined;{"\n"}

</CodeBlock>
<AnnotatedOnly>
<MarginText>7.a.1/3_D.14.2</MarginText>
<Admonition type="aarm" aarm="implementation-defined">
<b></b>The value of Min{"_"}Handler{"_"}Ceiling in Execution{"_"}Time.Group{"_"}Budgets.<br />
</Admonition>
</AnnotatedOnly>

<MarginText>8/2_D.14.2</MarginText>
<CodeBlock language="ada">
  procedure Add{"_"}Task (GB : in out Group{"_"}Budget;{"\n"}                      T  : in Ada.Task{"_"}Identification.Task{"_"}Id);{"\n"}  procedure Remove{"_"}Task (GB: in out Group{"_"}Budget;{"\n"}                         T  : in Ada.Task{"_"}Identification.Task{"_"}Id);{"\n"}  function Is{"_"}Member (GB : Group{"_"}Budget;{"\n"}                      T : Ada.Task{"_"}Identification.Task{"_"}Id) return Boolean;{"\n"}  function Is{"_"}A{"_"}Group{"_"}Member{"\n"}     (T : Ada.Task{"_"}Identification.Task{"_"}Id) return Boolean;{"\n"}  function Members (GB : Group{"_"}Budget) return Task{"_"}Array;{"\n"}
<MarginText>9/2_D.14.2</MarginText>
  procedure Replenish (GB : in out Group{"_"}Budget; To : in Time{"_"}Span);{"\n"}  procedure Add (GB : in out Group{"_"}Budget; Interval : in Time{"_"}Span);{"\n"}  function Budget{"_"}Has{"_"}Expired (GB : Group{"_"}Budget) return Boolean;{"\n"}  function Budget{"_"}Remaining (GB : Group{"_"}Budget) return Time{"_"}Span;{"\n"}
<MarginText>10/2_D.14.2</MarginText>
  procedure Set{"_"}Handler (GB      : in out Group{"_"}Budget;{"\n"}                         Handler : in Group{"_"}Budget{"_"}Handler);{"\n"}  function Current{"_"}Handler (GB : Group{"_"}Budget){"\n"}     return Group{"_"}Budget{"_"}Handler;{"\n"}  procedure Cancel{"_"}Handler (GB        : in out Group{"_"}Budget;{"\n"}                            Cancelled : out Boolean);{"\n"}
<MarginText>11/2_D.14.2</MarginText>
  Group{"_"}Budget{"_"}Error : exception;{"\n"}
<MarginText>12/2_D.14.2</MarginText>
private{"\n"}    --  not specified by the language{"\n"}end Ada.Execution{"_"}Time.Group{"_"}Budgets;{"\n"}

</CodeBlock>
<MarginText>13/2_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01"]} />
<p>The type Group{"_"}Budget represents an execution time budget to be used by a group of tasks. The type Group{"_"}Budget needs finalization (see <a href="/docs/arm/AA-7/AA-7.6">7.6</a>). A task can belong to at most one group. Tasks of any priority can be added to a group.<br /></p>

<MarginText>14/2_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01"]} />
<p>An object of type Group{"_"}Budget has an associated nonnegative value of type Time{"_"}Span known as its <i>budget</i>, which is initially Time{"_"}Span{"_"}Zero. The type Group{"_"}Budget{"_"}Handler identifies a protected procedure to be executed by the implementation when the budget is <i>exhausted</i>, that is, reaches zero. Such a protected procedure is called a <i>handler</i>. <br /></p>

<MarginText>15/2_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01"]} />
<p>An object of type Group{"_"}Budget also includes a handler, which is a value of type Group{"_"}Budget{"_"}Handler. The handler of the object is said to be <i>set</i> if it is not null and <i>cleared</i> otherwise. The handler of all Group{"_"}Budget objects is initially cleared. <br /></p>

<AnnotatedOnly>
<MarginText>15.a/2_D.14.2</MarginText>
<Admonition type="aarm" aarm="discussion">
<b></b>Type Group{"_"}Budget is tagged. This makes it possible to share a handler between several events. In simple cases, 'Access can be used to compare the parameter with a specific group budget object (this works because a tagged type is a by-reference type). In more complex cases, a type extension of type Group{"_"}Budget can be declared; a double type conversion can be used to access the extension data. An example of how this can be done can be found for the similar type Timing{"_"}Event, see <a href="/docs/arm/AA-D/AA-D.15">D.15</a>. <br />
</Admonition>
</AnnotatedOnly>


#### Dynamic Semantics

<MarginText>16/2_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01"]} />
<p>The procedure Add{"_"}Task adds the task identified by T to the group GB; if that task is already a member of some other group, Group{"_"}Budget{"_"}Error is raised.<br /></p>

<MarginText>17/2_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01"]} />
<p>The procedure Remove{"_"}Task removes the task identified by T from the group GB; if that task is not a member of the group GB, Group{"_"}Budget{"_"}Error is raised. After successful execution of this procedure, the task is no longer a member of any group.<br /></p>

<MarginText>18/3_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01", "AI05-0264-1"]} />
<p>The function Is{"_"}Member returns True if the task identified by T is a member of the group GB; otherwise, it returns False.<br /></p>

<MarginText>19/3_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01", "AI05-0264-1"]} />
<p>The function Is{"_"}A{"_"}Group{"_"}Member returns True if the task identified by T is a member of some group; otherwise, it returns False.<br /></p>

<MarginText>20/2_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01"]} />
<p>The function Members returns an array of values of type Task{"_"}Identification.Task{"_"}Id identifying the members of the group GB. The order of the components of the array is unspecified.<br /></p>

<MarginText>21/3_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01", "AI05-0092-1", "AI05-0169-1"]} />
<p>The procedure Replenish loads the group budget GB with To as the Time{"_"}Span value. The exception Group{"_"}Budget{"_"}Error is raised if the Time{"_"}Span value To is nonpositive. Any execution on CPU of any member of the group of tasks results in the budget counting down, unless exhausted. When the budget becomes exhausted (reaches Time{"_"}Span{"_"}Zero), the associated handler is executed if the handler of group budget GB is set. Nevertheless, the tasks continue to execute.<br /></p>

<MarginText>22/2_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01"]} />
<p>The procedure Add modifies the budget of the group GB. A positive value for Interval increases the budget. A negative value for Interval reduces the budget, but never below Time{"_"}Span{"_"}Zero. A zero value for Interval has no effect. A call of procedure Add that results in the value of the budget going to Time{"_"}Span{"_"}Zero causes the associated handler to be executed if the handler of the group budget GB is set.<br /></p>

<MarginText>23/3_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01", "AI05-0264-1"]} />
<p>The function Budget{"_"}Has{"_"}Expired returns True if the budget of group GB is exhausted (equal to Time{"_"}Span{"_"}Zero); otherwise, it returns False.<br /></p>

<MarginText>24/2_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01"]} />
<p>The function Budget{"_"}Remaining returns the remaining budget for the group GB. If the budget is exhausted it returns Time{"_"}Span{"_"}Zero. This is the minimum value for a budget.<br /></p>

<MarginText>25/3_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01", "AI05-0264-1"]} />
<p>The procedure Set{"_"}Handler associates the handler Handler with the Group{"_"}Budget GB: if Handler is <b>null</b>, the handler of Group{"_"}Budget is cleared; otherwise, it is set.<br /></p>

<MarginText>26/2_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01"]} />
<p>A call of Set{"_"}Handler for a Group{"_"}Budget that already has a handler set replaces the handler; if Handler is not <b>null</b>, the handler for Group{"_"}Budget remains set.<br /></p>

<MarginText>27/3_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01", "AI05-0264-1"]} />
<p>The function Current{"_"}Handler returns the handler associated with the group budget GB if the handler for that group budget is set; otherwise, it returns <b>null</b>.<br /></p>

<MarginText>28/3_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01", "AI05-0264-1"]} />
<p>The procedure Cancel{"_"}Handler clears the handler for the group budget if it is set. Cancelled is assigned True if the handler for the group budget was set prior to it being cleared; otherwise, it is assigned False.<br /></p>

<MarginText>29/2_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01"]} />
<p>The constant Min{"_"}Handler{"_"}Ceiling is the minimum ceiling priority required for a protected object with a handler to ensure that no ceiling violation will occur when that handler is invoked.<br /></p>

<MarginText>30/2_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01"]} />
<p>The precision of the accounting of task execution time to a Group{"_"}Budget is the same as that defined for execution-time clocks from the parent package.<br /></p>

<MarginText>31/2_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01"]} />
<p>As part of the finalization of an object of type Group{"_"}Budget all member tasks are removed from the group identified by that object.<br /></p>

<MarginText>32/3_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01", "AI05-0264-1"]} />
<p>If a task is a member of a Group{"_"}Budget when it terminates, then as part of the finalization of the task it is removed from the group.<br /></p>

<MarginText>33/2_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01"]} />
<p>For all the operations defined in this package, Tasking{"_"}Error is raised if the task identified by T has terminated, and Program{"_"}Error is raised if the value of T is Task{"_"}Identification.Null{"_"}Task{"_"}Id.<br /></p>

<MarginText>34/2_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01"]} />
<p>An exception propagated from a handler invoked when the budget of a group of tasks becomes exhausted has no effect.<br /></p>


#### Erroneous Execution

<MarginText>35/2_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01"]} />
<p>For a call of any of the subprograms defined in this package, if the task identified by T no longer exists, the execution of the program is erroneous. <br /></p>


#### Implementation Requirements

<MarginText>36/2_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01"]} />
<p>For a given Group{"_"}Budget object, the implementation shall perform the operations declared in this package atomically with respect to any of these operations on the same Group{"_"}Budget object. The replacement of a handler, by a call of Set{"_"}Handler, shall be performed atomically with respect to the execution of the handler. <br /></p>

<AnnotatedOnly>
<MarginText>36.a/2_D.14.2</MarginText>
<Admonition type="aarm" aarm="reason">
<b></b>This prevents various race conditions. In particular it ensures that if the budget is exhausted when Set{"_"}Handler is changing the handler then either the new or old handler is executed and the exhausting event is not lost. <br />
</Admonition>
</AnnotatedOnly>

<AnnotatedOnly>
<MarginText>37/2_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01"]} />
<Admonition type="aarm" aarm="note">
NOTE 1   Clearing or setting of the handler of a group budget does not change the current value of the budget. Exhaustion or loading of a budget does not change whether the handler of the group budget is set or cleared.<br />
</Admonition>
</AnnotatedOnly>

<AnnotatedOnly>
<MarginText>38/2_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01"]} />
<Admonition type="aarm" aarm="note">
NOTE 2   A Group{"_"}Budget{"_"}Handler can be associated with several Group{"_"}Budget objects. <br />
</Admonition>
</AnnotatedOnly>

<AnnotatedOnly>

#### Extensions to Ada 95

</AnnotatedOnly>
<AnnotatedOnly>
<MarginText>38.a/2_D.14.2</MarginText>
<MarginInfo items={["AI95-00354-01"]} />
<Admonition type="aarm" aarm="note">
The package Execution{"_"}Time.Group{"_"}Budgets is new. <br />
</Admonition>
</AnnotatedOnly>

<AnnotatedOnly>

#### Inconsistencies With Ada 2005

</AnnotatedOnly>
<AnnotatedOnly>
<MarginText>38.b/3_D.14.2</MarginText>
<MarginInfo items={["AI05-0169-1"]} />
<Admonition type="aarm" aarm="note">
A Group{"_"}Budget is now defined to work on a single processor. If an implementation managed to make this package work for programs running on a multiprocessor system, and a program depends on that fact, it could fail when ported to Ada 2012. We believe it is unlikely that such an implementation exists because of the difficulty of signalling other processors when the time reaches zero; in any case, depending on such an implementation is not portable. <br />
</Admonition>
</AnnotatedOnly>

<a id="Subclause_D.14.3"></a>

## D.14.3  Execution Time of Interrupt Handlers

<MarginText>1/3_D.14.3</MarginText>
<MarginInfo items={["AI05-0170-1", "AI05-0299-1"]} />
<p>This subclause describes a language-defined package to measure the execution time of interrupt handlers. <br /></p>


#### Static Semantics

<MarginText>2/3_D.14.3</MarginText>
<MarginInfo items={["AI05-0170-1"]} />
<p>The following language-defined library package exists: <br /></p>

<MarginText>3/5_D.14.3</MarginText>
<MarginInfo items={["AI12-0241-1", "AI12-0302-1"]} />
<CodeBlock language="ada">
with Ada.Interrupts;{"\n"}package Ada.Execution{"_"}Time.Interrupts{"\n"}   with Nonblocking, Global ={">"} in out synchronized is{"\n"}   function Clock (Interrupt : Ada.Interrupts.Interrupt{"_"}Id){"\n"}        return CPU{"_"}Time;{"\n"}   function Supported (Interrupt : Ada.Interrupts.Interrupt{"_"}Id){"\n"}        return Boolean;{"\n"}end Ada.Execution{"_"}Time.Interrupts;{"\n"}

</CodeBlock>
<MarginText>4/3_D.14.3</MarginText>
<MarginInfo items={["AI05-0170-1"]} />
<p>The execution time or CPU time of a given interrupt Interrupt is defined as the time spent by the system executing interrupt handlers identified by Interrupt, including the time spent executing run-time or system services on its behalf. The mechanism used to measure execution time is implementation defined. Time spent executing interrupt handlers is distinct from time spent executing any task. <br /></p>

<AnnotatedOnly>
<MarginText>4.a/3_D.14.3</MarginText>
<Admonition type="aarm" aarm="discussion">
<b></b>The implementation-defined mechanism here is the same as that covered by the Documentation Requirements of <a href="/docs/arm/AA-D/AA-D.14">D.14</a>, so we don't repeat that requirement here. <br />
</Admonition>
</AnnotatedOnly>

<MarginText>5/3_D.14.3</MarginText>
<MarginInfo items={["AI05-0170-1"]} />
<p>For each interrupt, the execution time value is initially set to zero. <br /></p>


#### Dynamic Semantics

<MarginText>6/3_D.14.3</MarginText>
<MarginInfo items={["AI05-0170-1"]} />
<p>The function Clock returns the current cumulative execution time of the interrupt identified by Interrupt. If Separate{"_"}Interrupt{"_"}Clocks{"_"}Supported is set to False the function raises Program{"_"}Error.<br /></p>

<MarginText>7/3_D.14.3</MarginText>
<MarginInfo items={["AI05-0170-1", "AI05-0264-1"]} />
<p>The function Supported returns True if the implementation is monitoring the execution time of the interrupt identified by Interrupt; otherwise, it returns False. For any Interrupt{"_"}Id Interrupt for which Supported(Interrupt) returns False, the function Clock(Interrupt) will return a value equal to Ada.Execution{"_"}Time.Time{"_"}Of(0).<br /></p>

<AnnotatedOnly>

#### Extensions to Ada 2005

</AnnotatedOnly>
<AnnotatedOnly>
<MarginText>7.a/3_D.14.3</MarginText>
<MarginInfo items={["AI05-0170-1"]} />
<Admonition type="aarm" aarm="note">
The package Execution{"_"}Time.Interrupts is new. <br />
</Admonition>
</AnnotatedOnly>


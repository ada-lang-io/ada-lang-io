"use strict";(self.webpackChunkada_lang_io=self.webpackChunkada_lang_io||[]).push([[8471],{97230:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>m,contentTitle:()=>l,default:()=>j,frontMatter:()=>h,metadata:()=>p,toc:()=>x});var i=n(74848),t=n(28453),a=n(13842),r=n(91435),o=n(21432),c=n(79162),d=n(34421);const h={sidebar_position:170},l="D.16 Multiprocessor Implementation",p={id:"arm/AA-D/AA-D.16",title:"D.16 Multiprocessor Implementation",description:"This Reference Manual output has not been verified,",source:"@site/docs/arm/AA-D/AA-D.16.mdx",sourceDirName:"arm/AA-D",slug:"/arm/AA-D/AA-D.16",permalink:"/docs/arm/AA-D/AA-D.16",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:170,frontMatter:{sidebar_position:170},sidebar:"referenceManualSidebar",previous:{title:"D.15 Timing Events",permalink:"/docs/arm/AA-D/AA-D.15"},next:{title:"Annex E Distributed Systems",permalink:"/docs/arm/AA-E/"}},m={},x=[{value:"Static Semantics",id:"static-semantics",level:4},{value:"Legality Rules",id:"legality-rules",level:4},{value:"Dynamic Semantics",id:"dynamic-semantics",level:4},{value:"Implementation Advice",id:"implementation-advice",level:4},{value:"Extensions to Ada 2005",id:"extensions-to-ada-2005",level:4},{value:"Extensions to Ada 2012",id:"extensions-to-ada-2012",level:4},{value:"Wording Changes from Ada 2012",id:"wording-changes-from-ada-2012",level:4},{value:"D.16.1  Multiprocessor Dispatching Domains",id:"d161--multiprocessor-dispatching-domains",level:2},{value:"Static Semantics",id:"static-semantics-1",level:4},{value:"Legality Rules",id:"legality-rules-1",level:4},{value:"Dynamic Semantics",id:"dynamic-semantics-1",level:4},{value:"Implementation Requirements",id:"implementation-requirements",level:4},{value:"Implementation Advice",id:"implementation-advice-1",level:4},{value:"Documentation Requirements",id:"documentation-requirements",level:4},{value:"Implementation Permissions",id:"implementation-permissions",level:4},{value:"Extensions to Ada 2005",id:"extensions-to-ada-2005-1",level:4},{value:"Inconsistencies With Ada 2012",id:"inconsistencies-with-ada-2012",level:4},{value:"Incompatibilities With Ada 2012",id:"incompatibilities-with-ada-2012",level:4},{value:"Wording Changes from Ada 2012",id:"wording-changes-from-ada-2012-1",level:4}];function A(e){const s={a:"a",admonition:"admonition",h1:"h1",h2:"h2",h4:"h4",p:"p",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h1,{id:"d16-multiprocessor-implementation",children:"D.16 Multiprocessor Implementation"}),"\n",(0,i.jsx)(s.admonition,{type:"danger",children:(0,i.jsxs)(s.p,{children:["This Reference Manual output has not been verified,\nand may contain omissions or errors.\nReport any problems on the ",(0,i.jsx)(s.a,{href:"https://github.com/ada-lang-io/ada-lang-io/issues/20",children:"tracking issue"})]})}),"\n","\n",(0,i.jsx)(c.A,{children:"1/3"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0171-1","AI05-0299-1"]}),"\n",(0,i.jsxs)("p",{children:["This subclause allows implementations on multiprocessor platforms to be configured. ",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(s.h4,{id:"static-semantics",children:"Static Semantics"}),"\n",(0,i.jsx)(c.A,{children:"2/3"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0171-1"]}),"\n",(0,i.jsxs)("p",{children:["The following language-defined library package exists: ",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"3/5"}),"\n",(0,i.jsx)(d.A,{items:["AI12-0241-1","AI12-0302-1"]}),"\n",(0,i.jsx)(o.A,{language:"ada",children:(0,i.jsxs)(s.p,{children:["package System.Multiprocessors","\n","   with Preelaborate, Nonblocking, Global =",">"," in out synchronized is","\n","\n",(0,i.jsx)(c.A,{children:"4/3"}),"\ntype CPU","_","Range is range 0 .. implementation-defined;","\n","   Not","_","A","_","Specific","_","CPU : constant CPU","_","Range := 0;","\n","   subtype CPU is CPU","_","Range range 1 .. CPU","_","Range'Last;","\n"]})}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"4.a.1/3"}),(0,i.jsx)(a.A,{type:"aarm",aarm:"implementation-defined",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)("strong",{}),"The value of CPU","_","Range'Last in System.Multiprocessors.",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsx)(c.A,{children:"5/3"}),"\n",(0,i.jsx)(o.A,{language:"ada",children:(0,i.jsxs)(s.p,{children:["function Number","_","Of","_","CPUs return CPU;","\n","end System.Multiprocessors;","\n"]})}),"\n",(0,i.jsx)(c.A,{children:"6/3"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0171-1"]}),"\n",(0,i.jsxs)("p",{children:["A call of Number","_","Of","_","CPUs returns the number of processors available to the program. Within a given partition, each call on Number","_","Of","_","CPUs will return the same value.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"7/5"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0229-1","AI12-0281-1"]}),"\n",(0,i.jsxs)("p",{children:["For a task type (including the anonymous type of a ",(0,i.jsx)("code",{children:(0,i.jsx)("a",{href:"/docs/arm/AA-9/AA-9.1#S0245",children:"single_task_declaration"})}),"), protected type (including the anonymous type of a ",(0,i.jsx)("code",{children:(0,i.jsx)("a",{href:"/docs/arm/AA-9/AA-9.4#S0250",children:"single_protected_declaration"})}),"), or subprogram, the following language-defined representation aspect may be specified:",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"8/3"}),"\n",(0,i.jsxs)("dt",{children:[(0,i.jsx)("br",{}),"CPU"]}),"\n",(0,i.jsx)("dl",{children:(0,i.jsxs)("dd",{children:["The aspect CPU is an ",(0,i.jsx)("code",{children:(0,i.jsx)("a",{href:"/docs/arm/AA-4/AA-4.4#S0132",children:"expression"})}),", which shall be of type System.Multiprocessors.CPU","_","Range.",(0,i.jsx)("br",{})]})}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"8.a/5"}),(0,i.jsx)(a.A,{type:"aarm",aarm:"note",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)("strong",{children:"Aspect Description for "}),(0,i.jsx)("strong",{children:"CPU: "}),"Processor on which a given task, or calling task for a protected operation, should run.",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsx)(s.h4,{id:"legality-rules",children:"Legality Rules"}),"\n",(0,i.jsx)(c.A,{children:"9/3"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0171-1","AI05-0229-1"]}),"\n",(0,i.jsxs)("p",{children:["If the CPU aspect is specified for a subprogram, the ",(0,i.jsx)("code",{children:(0,i.jsx)("a",{href:"/docs/arm/AA-4/AA-4.4#S0132",children:"expression"})})," shall be static.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"10/5"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0229-1","AI12-0281-1"]}),"\n",(0,i.jsxs)("p",{children:["The CPU aspect shall not be specified on a task or protected interface type.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(s.h4,{id:"dynamic-semantics",children:"Dynamic Semantics"}),"\n",(0,i.jsx)(c.A,{children:"11/5"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0171-1","AI05-0229-1","AI12-0081-1","AI12-0281-1"]}),"\n",(0,i.jsxs)("p",{children:["The ",(0,i.jsx)("code",{children:(0,i.jsx)("a",{href:"/docs/arm/AA-4/AA-4.4#S0132",children:"expression"})})," specified for the CPU aspect of a task or protected type is evaluated each time an object of the corresponding type is created (see ",(0,i.jsx)("a",{href:"/docs/arm/AA-9/AA-9.1",children:"9.1"})," and ",(0,i.jsx)("a",{href:"/docs/arm/AA-9/AA-9.4",children:"9.4"}),"). The CPU value is then associated with the object.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"12/3"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0171-1","AI05-0229-1"]}),"\n",(0,i.jsxs)("p",{children:["The CPU aspect has no effect if it is specified for a subprogram other than the main subprogram; the CPU value is not associated with any task.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"13/3"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0171-1","AI05-0229-1"]}),"\n",(0,i.jsxs)("p",{children:["The CPU value is associated with the environment task if the CPU aspect is specified for the main subprogram. If the CPU aspect is not specified for the main subprogram it is implementation defined on which processor the environment task executes. ",(0,i.jsx)("br",{})]}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"13.a.1/3"}),(0,i.jsx)(a.A,{type:"aarm",aarm:"implementation-defined",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)("strong",{}),"The processor on which the environment task executes in the absence of a value for the aspect CPU.",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsx)(c.A,{children:"14/5"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0171-1","AI05-0264-1","AI12-0281-1"]}),"\n",(0,i.jsxs)("p",{children:["For a task, the CPU value determines the processor on which the task will activate and execute; the task is said to be assigned to that processor. If the CPU value is Not","_","A","_","Specific","_","CPU, then the task is not assigned to a processor. A task without a CPU aspect specified will activate and execute on the same processor as its activating task if the activating task is assigned a processor. If the CPU value is not in the range of System.Multiprocessors.CPU","_","Range or is greater than Number","_","Of","_","CPUs the task is defined to have failed, and it becomes a completed task (see ",(0,i.jsx)("a",{href:"/docs/arm/AA-9/AA-9.2",children:"9.2"}),").",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"15/5"}),"\n",(0,i.jsx)(d.A,{items:["AI12-0281-1"]}),"\n",(0,i.jsxs)("p",{children:["For a protected type, the CPU value determines the processor on which calling tasks will execute; the protected object is said to be assigned to that processor. If the CPU value is Not","_","A","_","Specific","_","CPU, then the protected object is not assigned to a processor. A call to a protected object that is assigned to a processor from a task that is not assigned a processor or is assigned a different processor raises Program","_","Error.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"15.a/5"}),(0,i.jsx)(d.A,{items:["AI12-0005-1"]}),(0,i.jsx)(a.A,{type:"aarm",aarm:"discussion",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)("strong",{}),"When a protected object is assigned to a CPU, only tasks also assigned to that CPU can call it. In contrast, a protected object that is not assigned to a specific CPU can be called by any task on any processor (subject, of course, to visibility and ceiling priority restrictions). As noted below, when the tasks and protected object are necessarily on the same CPU, a simpler implementation can be used. ",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsx)(s.h4,{id:"implementation-advice",children:"Implementation Advice"}),"\n",(0,i.jsx)(c.A,{children:"16/5"}),"\n",(0,i.jsx)(d.A,{items:["AI12-0281-1","AI12-0323-1"]}),"\n",(0,i.jsxs)("p",{children:["Starting a protected action on a protected object statically assigned to a processor should be implemented without busy-waiting.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"16.a/5"}),(0,i.jsx)(a.A,{type:"aarm",aarm:"reason",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)("strong",{}),"Busy-waiting is a form of lock and can be a source of deadlock. Busy-waiting is typically needed for starting protected actions on multiprocessors, but if all tasks calling a protected object execute on the same CPU, this locking isn't needed and the source of deadlock and associated overhead can be eliminated. ",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"16.b/5"}),(0,i.jsx)(a.A,{type:"aarm",aarm:"implementation-advice",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)("strong",{}),"Starting a protected action on a protected object statically assigned to a processor should not use busy-waiting.",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsx)(r.A,{children:(0,i.jsx)(s.h4,{id:"extensions-to-ada-2005",children:"Extensions to Ada 2005"})}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"16.c/3"}),(0,i.jsx)(d.A,{items:["AI05-0171-1","AI05-0229-1"]}),(0,i.jsx)(a.A,{type:"aarm",aarm:"note",children:(0,i.jsxs)(s.p,{children:["The package System.Multiprocessors and the CPU aspect are new. ",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsx)(r.A,{children:(0,i.jsx)(s.h4,{id:"extensions-to-ada-2012",children:"Extensions to Ada 2012"})}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"16.d/5"}),(0,i.jsx)(d.A,{items:["AI12-0281-1"]}),(0,i.jsx)(a.A,{type:"aarm",aarm:"note",children:(0,i.jsxs)(s.p,{children:["Aspect CPU can now be applied to protected types, in order to avoid the overhead and deadlock potential of multiprocessor execution. ",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsx)(r.A,{children:(0,i.jsx)(s.h4,{id:"wording-changes-from-ada-2012",children:"Wording Changes from Ada 2012"})}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"16.e/4"}),(0,i.jsx)(d.A,{items:["AI12-0081-1"]}),(0,i.jsx)(a.A,{type:"aarm",aarm:"note",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)("strong",{children:"Corrigendum:"})," Clarified when the CPU aspect expression is evaluated. ",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsx)("a",{id:"Subclause_D.16.1"}),"\n",(0,i.jsx)(s.h2,{id:"d161--multiprocessor-dispatching-domains",children:"D.16.1  Multiprocessor Dispatching Domains"}),"\n",(0,i.jsx)(c.A,{children:"1/3_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0167-1","AI05-0299-1"]}),"\n",(0,i.jsxs)("p",{children:["This subclause allows implementations on multiprocessor platforms to be partitioned into distinct dispatching domains during program startup.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(s.h4,{id:"static-semantics-1",children:"Static Semantics"}),"\n",(0,i.jsx)(c.A,{children:"2/3_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0167-1"]}),"\n",(0,i.jsxs)("p",{children:["The following language-defined library package exists: ",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"3/5_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI12-0241-1","AI12-0302-1"]}),"\n",(0,i.jsxs)(o.A,{language:"ada",children:[(0,i.jsxs)(s.p,{children:["with Ada.Real","_","Time;","\n","with Ada.Task","_","Identification;","\n","package System.Multiprocessors.Dispatching","_","Domains","\n","   with Nonblocking, Global =",">"," in out synchronized is","\n","\n",(0,i.jsx)(c.A,{children:"4/3_D.16.1"}),"\nDispatching","_","Domain","_","Error : exception;","\n","\n",(0,i.jsx)(c.A,{children:"5/3_D.16.1"}),"\ntype Dispatching","_","Domain (","<",">",") is limited private;","\n","\n",(0,i.jsx)(c.A,{children:"6/3_D.16.1"}),"\nSystem","_","Dispatching","_","Domain : constant Dispatching","_","Domain;","\n","\n",(0,i.jsx)(c.A,{children:"7/4_D.16.1"})]}),(0,i.jsx)(d.A,{items:["AI12-0033-1"]}),(0,i.jsxs)(s.p,{children:["function Create (First : CPU; Last : CPU","_","Range) return Dispatching","_","Domain;","\n","\n",(0,i.jsx)(c.A,{children:"8/3_D.16.1"}),"\nfunction Get","_","First","_","CPU (Domain : Dispatching","_","Domain) return CPU;","\n","\n",(0,i.jsx)(c.A,{children:"9/4_D.16.1"})]}),(0,i.jsx)(d.A,{items:["AI12-0033-1"]}),(0,i.jsxs)(s.p,{children:["function Get","_","Last","_","CPU  (Domain : Dispatching","_","Domain) return CPU","_","Range;","\n","\n",(0,i.jsx)(c.A,{children:"9.1/4_D.16.1"})]}),(0,i.jsx)(d.A,{items:["AI12-0033-1"]}),(0,i.jsxs)(s.p,{children:["type CPU","_","Set is array(CPU range ","<",">",") of Boolean;","\n","\n",(0,i.jsx)(c.A,{children:"9.2/4_D.16.1"})]}),(0,i.jsx)(d.A,{items:["AI12-0033-1"]}),(0,i.jsxs)(s.p,{children:["function Create (Set : CPU","_","Set) return Dispatching","_","Domain;","\n","\n",(0,i.jsx)(c.A,{children:"9.3/4_D.16.1"})]}),(0,i.jsx)(d.A,{items:["AI12-0033-1"]}),(0,i.jsxs)(s.p,{children:["function Get","_","CPU","_","Set (Domain : Dispatching","_","Domain) return CPU","_","Set;","\n","\n",(0,i.jsx)(c.A,{children:"10/3_D.16.1"}),"\nfunction Get","_","Dispatching","_","Domain","\n","      (T   : Ada.Task","_","Identification.Task","_","Id :=","\n","                 Ada.Task","_","Identification.Current","_","Task)","\n","           return Dispatching","_","Domain;","\n","\n",(0,i.jsx)(c.A,{children:"11/3_D.16.1"}),"\nprocedure Assign","_","Task","\n","      (Domain : in out Dispatching","_","Domain;","\n","       CPU    : in     CPU","_","Range := Not","_","A","_","Specific","_","CPU;","\n","       T      : in     Ada.Task","_","Identification.Task","_","Id :=","\n","                 Ada.Task","_","Identification.Current","_","Task);","\n","\n",(0,i.jsx)(c.A,{children:"12/3_D.16.1"}),"\nprocedure Set","_","CPU","\n","      (CPU : in CPU","_","Range;","\n","       T   : in Ada.Task","_","Identification.Task","_","Id :=","\n","                 Ada.Task","_","Identification.Current","_","Task);","\n","\n",(0,i.jsx)(c.A,{children:"13/3_D.16.1"}),"\nfunction Get","_","CPU","\n","      (T   : Ada.Task","_","Identification.Task","_","Id :=","\n","                 Ada.Task","_","Identification.Current","_","Task)","\n","           return CPU","_","Range;","\n","\n",(0,i.jsx)(c.A,{children:"14/3_D.16.1"}),"\nprocedure Delay","_","Until","_","And","_","Set","_","CPU","\n","      (Delay","_","Until","_","Time : in Ada.Real","_","Time.Time; CPU : in CPU","_","Range);","\n","\n",(0,i.jsx)(c.A,{children:"15/3_D.16.1"}),"\nprivate","\n","   ... -- not specified by the language","\n","end System.Multiprocessors.Dispatching","_","Domains;","\n"]})]}),"\n",(0,i.jsx)(c.A,{children:"16/4_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0167-1","AI12-0082-1"]}),"\n",(0,i.jsxs)("p",{children:["A ",(0,i.jsx)("em",{children:"dispatching domain"})," represents a set of processors on which a task may execute. Each processor is contained within exactly one dispatching domain. An object of type Dispatching","_","Domain identifies a dispatching domain. System","_","Dispatching","_","Domain identifies a domain that contains the processor or processors on which the environment task executes. At program start-up all processors are contained within this domain.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"17/3_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0167-1"]}),"\n",(0,i.jsxs)("p",{children:["For a task type (including the anonymous type of a ",(0,i.jsx)("code",{children:(0,i.jsx)("a",{href:"/docs/arm/AA-9/AA-9.1#S0245",children:"single_task_declaration"})}),"), the following language-defined representation aspect may be specified:",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"18/3_D.16.1"}),"\n",(0,i.jsxs)("dt",{children:[(0,i.jsx)("br",{}),"Dispatching","_","Domain"]}),"\n",(0,i.jsx)("dl",{children:(0,i.jsxs)("dd",{children:["The value of aspect Dispatching","_","Domain is an ",(0,i.jsx)("code",{children:(0,i.jsx)("a",{href:"/docs/arm/AA-4/AA-4.4#S0132",children:"expression"})}),", which shall be of type Dispatching","_","Domains.Dispatching","_","Domain. This aspect is the domain to which the task (or all objects of the task type) are assigned.",(0,i.jsx)("br",{})]})}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"18.a/3_D.16.1"}),(0,i.jsx)(a.A,{type:"aarm",aarm:"note",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)("strong",{children:"Aspect Description for "}),(0,i.jsxs)("strong",{children:["Dispatching","_","Domain: "]}),"Domain (group of processors) on which a given task should run.",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsx)(s.h4,{id:"legality-rules-1",children:"Legality Rules"}),"\n",(0,i.jsx)(c.A,{children:"19/3_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0167-1"]}),"\n",(0,i.jsxs)("p",{children:["The Dispatching","_","Domain aspect shall not be specified for a task interface.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(s.h4,{id:"dynamic-semantics-1",children:"Dynamic Semantics"}),"\n",(0,i.jsx)(c.A,{children:"20/4_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0167-1","AI12-0033-1"]}),"\n",(0,i.jsxs)("p",{children:["The expression specified for the Dispatching","_","Domain aspect of a task type is evaluated each time an object of the task type is created (see ",(0,i.jsx)("a",{href:"/docs/arm/AA-9/AA-9.1",children:"9.1"}),"). If the identified dispatching domain is empty, then Dispatching","_","Domain","_","Error is raised; otherwise the newly created task is assigned to the domain identified by the value of the expression.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"21/3_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0167-1"]}),"\n",(0,i.jsxs)("p",{children:["If a task is not explicitly assigned to any domain, it is assigned to that of the activating task. A task always executes on some CPU in its domain.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"22/4_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0167-1","AI12-0082-1"]}),"\n",(0,i.jsxs)("p",{children:["If both the dispatching domain and CPU are specified for a task, and the CPU value is not contained within the set of processors for the domain (and is not Not","_","A","_","Specific","_","CPU), the activation of the task is defined to have failed, and it becomes a completed task (see ",(0,i.jsx)("a",{href:"/docs/arm/AA-9/AA-9.2",children:"9.2"}),").",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"23/4_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0167-1","AI12-0033-1"]}),"\n",(0,i.jsxs)("p",{children:["The function Create with First and Last parameters creates and returns a dispatching domain containing all the processors in the range First .. Last. The function Create with a Set parameter creates and returns a dispatching domain containing the processors for which Set(I) is True. These processors are removed from System","_","Dispatching","_","Domain. A call of Create will raise Dispatching","_","Domain","_","Error if any designated processor is not currently in System","_","Dispatching","_","Domain, or if the system cannot support a distinct domain over the processors identified, or if a processor has a task assigned to it, or if the allocation would leave System","_","Dispatching","_","Domain empty. A call of Create will raise Dispatching","_","Domain","_","Error if the calling task is not the environment task, or if Create is called after the call to the main subprogram.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"24/4_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0167-1","AI12-0033-1"]}),"\n",(0,i.jsxs)("p",{children:["The function Get","_","First","_","CPU returns the first CPU in Domain, or CPU'First if Domain is empty; Get","_","Last","_","CPU returns the last CPU in Domain, or CPU","_","Range'First if Domain is empty. The function Get","_","CPU","_","Set(D) returns an array whose low bound is Get","_","First","_","CPU(D), whose high bound is Get","_","Last","_","CPU(D), with True values in the Set corresponding to the CPUs that are in the given Domain.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"25/4_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0167-1","AI12-0082-1"]}),"\n",(0,i.jsxs)("p",{children:["The function Get","_","Dispatching","_","Domain returns the dispatching domain on which the task is assigned.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"26/4_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0167-1","AI05-0278-1","AI12-0033-1"]}),"\n",(0,i.jsxs)("p",{children:["A call of the procedure Assign","_","Task assigns task T to the CPU within the dispatching domain Domain. Task T can now execute only on CPU, unless CPU designates Not","_","A","_","Specific","_","CPU in which case it can execute on any processor within Domain. The exception Dispatching","_","Domain","_","Error is propagated if Domain is empty, T is already assigned to a dispatching domain other than System","_","Dispatching","_","Domain, or if CPU is not one of the processors of Domain (and is not Not","_","A","_","Specific","_","CPU). A call of Assign","_","Task is a task dispatching point for task T unless T is inside of a protected action, in which case the effect on task T is delayed until its next task dispatching point. If T is the Current","_","Task the effect is immediate if T is not inside a protected action, otherwise the effect is as soon as practical. Assigning a task already assigned to System","_","Dispatching","_","Domain to that domain has no effect.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"27/4_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0167-1","AI05-0278-1","AI12-0082-1"]}),"\n",(0,i.jsxs)("p",{children:["A call of procedure Set","_","CPU assigns task T to the CPU. Task T can now execute only on CPU, unless CPU designates Not","_","A","_","Specific","_","CPU, in which case it can execute on any processor within its dispatching domain. The exception Dispatching","_","Domain","_","Error is propagated if CPU is not one of the processors of the dispatching domain on which T is assigned (and is not Not","_","A","_","Specific","_","CPU). A call of Set","_","CPU is a task dispatching point for task T unless T is inside of a protected action, in which case the effect on task T is delayed until its next task dispatching point. If T is the Current","_","Task the effect is immediate if T is not inside a protected action, otherwise the effect is as soon as practical.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"28/3_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0167-1"]}),"\n",(0,i.jsxs)("p",{children:["The function Get","_","CPU returns the processor assigned to task T, or Not","_","A","_","Specific","_","CPU if the task is not assigned to a processor.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"29/4_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0167-1","AI12-0082-1"]}),"\n",(0,i.jsxs)("p",{children:["A call of Delay","_","Until","_","And","_","Set","_","CPU delays the calling task for the designated time and then assigns the task to the specified processor when the delay expires. The exception Dispatching","_","Domain","_","Error is propagated if P is not one of the processors of the calling task's dispatching domain (and is not Not","_","A","_","Specific","_","CPU).",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(s.h4,{id:"implementation-requirements",children:"Implementation Requirements"}),"\n",(0,i.jsx)(c.A,{children:"30/3_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0167-1"]}),"\n",(0,i.jsxs)("p",{children:["The implementation shall perform the operations Assign","_","Task, Set","_","CPU, Get","_","CPU and Delay","_","Until","_","And","_","Set","_","CPU atomically with respect to any of these operations on the same dispatching","_","domain, processor or task.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"30.1/4_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI12-0048-1"]}),"\n",(0,i.jsxs)("p",{children:["Any task that belongs to the system dispatching domain can execute on any CPU within that domain, unless the assignment of the task has been specified.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"30.a/4_D.16.1"}),(0,i.jsx)(a.A,{type:"aarm",aarm:"reason",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)("strong",{}),"This ensures that priorities and deadlines are respected within the system dispatching domain. There is no such guarantee between different domains.",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"30.b/4_D.16.1"}),(0,i.jsx)(a.A,{type:"aarm",aarm:"note",children:(0,i.jsxs)(s.p,{children:["We only need to talk about the system dispatching domain here, because Assign","_","Task and Set","_","CPU already have such wording for tasks that are assigned explicitly to a dispatching domain and specify Not","_","a","_","Specific","_","CPU. ",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"30.c/4_D.16.1"}),(0,i.jsx)(a.A,{type:"aarm",aarm:"ramification",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)("strong",{}),"If no dispatching domains are created, all tasks can execute on all processors. (As always, implementation-defined dispatching policies may have other rules, so a partition that does not specify any language-defined dispatching policy may do anything at all and in particular does not need to follow this rule. ",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"30.d/4_D.16.1"}),(0,i.jsx)(a.A,{type:"aarm",aarm:"discussion",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)("strong",{}),"A task can be assigned to a specific CPU by specifying the aspect CPU for a task, or by calling a dynamic operation like Set","_","CPU or Assign","_","Task. ",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsx)(s.h4,{id:"implementation-advice-1",children:"Implementation Advice"}),"\n",(0,i.jsx)(c.A,{children:"31/3_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0167-1"]}),"\n",(0,i.jsxs)("p",{children:["Each dispatching domain should have separate and disjoint ready queues.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"31.a/3_D.16.1"}),(0,i.jsx)(a.A,{type:"aarm",aarm:"implementation-advice",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)("strong",{}),"Each dispatching domain should have separate and disjoint ready queues.",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"31.b/4_D.16.1"}),(0,i.jsx)(d.A,{items:["AI12-0048-1"]}),(0,i.jsx)(a.A,{type:"aarm",aarm:"note",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)("strong",{children:"To be honest: "}),'\u201cReady queue\u201d here doesn\'t mean the conceptual "ready queue" as defined in ',(0,i.jsx)("a",{href:"/docs/arm/AA-D/AA-D.2#Subclause_D.2.1",children:"D.2.1"})," (one per processor); this rule is talking about the ready queues used by the implementation. ",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsx)(s.h4,{id:"documentation-requirements",children:"Documentation Requirements"}),"\n",(0,i.jsx)(c.A,{children:"32/3_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0167-1"]}),"\n",(0,i.jsxs)("p",{children:["The implementation shall document the processor(s) on which the clock interrupt is handled and hence where delay queue and ready queue manipulations occur. For any Interrupt","_","Id whose handler can execute on more than one processor the implementation shall also document this set of processors.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"32.a/3_D.16.1"}),(0,i.jsx)(a.A,{type:"aarm",aarm:"note",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)("strong",{children:"Documentation Requirement: "}),"The processor(s) on which the clock interrupt is handled; the processors on which each Interrupt","_","Id can be handled.",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsx)(s.h4,{id:"implementation-permissions",children:"Implementation Permissions"}),"\n",(0,i.jsx)(c.A,{children:"33/3_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI05-0167-1"]}),"\n",(0,i.jsxs)("p",{children:["An implementation may limit the number of dispatching domains that can be created and raise Dispatching","_","Domain","_","Error if an attempt is made to exceed this number.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsx)(c.A,{children:"34/5_D.16.1"}),"\n",(0,i.jsx)(d.A,{items:["AI12-0119-1"]}),"\n",(0,i.jsxs)("p",{children:["The implementation may defer the effect of a Set","_","CPU or an Assign","_","Task operation until the specified task leaves an ongoing parallel construct.",(0,i.jsx)("br",{})]}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"34.a/5_D.16.1"}),(0,i.jsx)(d.A,{items:["AI12-0119-1"]}),(0,i.jsx)(a.A,{type:"aarm",aarm:"reason",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)("strong",{}),"These operations can change the set of CPUs that a parallel operation is allowed to use. This could require the ability to move or suspend one or more threads to execute them on a different CPU. However, parallel constructs are primarily intended to improve performance of code, and the overhead needed to support such a rarely used operation could be substantial. Therefore, rather than requiring support we allow the implementation to wait to implement these operations until the parallel construct (and thus the extra threads) have completed. ",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsx)(r.A,{children:(0,i.jsx)(s.h4,{id:"extensions-to-ada-2005-1",children:"Extensions to Ada 2005"})}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"34.b/3_D.16.1"}),(0,i.jsx)(d.A,{items:["AI05-0167-1","AI05-0278-1"]}),(0,i.jsx)(a.A,{type:"aarm",aarm:"note",children:(0,i.jsxs)(s.p,{children:["The package System.Multiprocessors.Dispatching","_","Domains and the aspect Dispatching","_","Domains are new. ",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsx)(r.A,{children:(0,i.jsx)(s.h4,{id:"inconsistencies-with-ada-2012",children:"Inconsistencies With Ada 2012"})}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"34.c/4_D.16.1"}),(0,i.jsx)(d.A,{items:["AI12-0033-1"]}),(0,i.jsx)(a.A,{type:"aarm",aarm:"note",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)("strong",{children:"Corrigendum:"})," We now explicitly allow empty dispatching domains, as it would be difficult to avoid declaring them when a system is configured at runtime. Therefore, assigning a task to an empty domain now raises Dispatching","_","Domain","_","Error; creating such a domain should not raise Dispatching","_","Domain","_","Error. If an implementation does something different in these cases, and a program depends on that difference, the program could malfunction. This seems very unlikely (if no exception is ever raised, the task assigned to the empty domain could never run; if the exception is raised earlier, the program can't do anything useful). ",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsx)(r.A,{children:(0,i.jsx)(s.h4,{id:"incompatibilities-with-ada-2012",children:"Incompatibilities With Ada 2012"})}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"34.d/5_D.16.1"}),(0,i.jsx)(d.A,{items:["AI05-0005-1","AI05-0033-1"]}),(0,i.jsx)(a.A,{type:"aarm",aarm:"note",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)("strong",{children:"Corrigendum:"})," The subtypes of the parameter or result of several routines were changed to support empty domains. These changes will cause rules requiring subtype conformance to fail on these routines (such as 'Access). We believe such uses are unlikely. In addition, type CPU","_","Set and function Get","_","CPU","_","Set, along with an overloaded Create are newly added to this package. As such, a use clause conflict is possible; see the introduction of ",(0,i.jsx)("a",{href:"/docs/arm/AA-A/",children:"Annex A"})," for more on this topic. ",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsx)(r.A,{children:(0,i.jsx)(s.h4,{id:"wording-changes-from-ada-2012-1",children:"Wording Changes from Ada 2012"})}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"34.e/4_D.16.1"}),(0,i.jsx)(d.A,{items:["AI12-0048-1"]}),(0,i.jsx)(a.A,{type:"aarm",aarm:"note",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)("strong",{children:"Corrigendum:"})," Added wording to clarify that all tasks can execute on all CPUs of the system dispatching domain by default.",(0,i.jsx)("br",{})]})})]}),"\n",(0,i.jsxs)(r.A,{children:[(0,i.jsx)(c.A,{children:"34.f/4_D.16.1"}),(0,i.jsx)(d.A,{items:["AI12-0082-1"]}),(0,i.jsx)(a.A,{type:"aarm",aarm:"note",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)("strong",{children:"Corrigendum:"}),' Added a definition to clarify that a "dispatching domain" is a concept which is identified by an object of type Dispatching',"_","Domain; more than one object might identify the same dispatching domain (for instance, the result of function Get","_","Dispatching","_","Domain is a different object but identifies the same dispatching domain). ",(0,i.jsx)("br",{})]})})]})]})}function j(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(A,{...e})}):A(e)}}}]);